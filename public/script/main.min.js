$(document).ready(function(){var t={USE:{mainurl:"public/data/main.json",menuData:{},check:[],ZeroClipboardPath:"public/script/ZeroClipboard.swf",basePath:""},DOM:{$doc:$(document),$prompt:$("#prompt"),$wrapper:$("#wrapper"),$menus:$("#wrapper li .menu"),$contents:$("#wrapper li .content"),$menuTemplate:$("#menuListTemplate"),$contentTemplate:$("#contentTemplate")},TMP:window.juicer,METHODS:{}};t.METHODS.BuildDom=function(n,e){var i=t.TMP(e.html());return function(t,e){n.append(i.render(t)),e(n)}},t.METHODS.GetCurrPath=function(){var t=window.location.href,n=t.replace(/\w+\.html$/g,"");return n},t.USE.basePath=t.METHODS.GetCurrPath(),t.TMP.register("buildURL",function(n){return t.USE.basePath+n}),t.TMP.register("buildMURL",function(n){return"![]("+t.USE.basePath+n+")"}),t.DOM.$doc.on("copyOK",function(){t.DOM.$prompt.show(400).delay(800).hide(400)}),t.DOM.$wrapper.on("loadContent","li .content",function(n,e){var i=$(this),o=e.index,r=i.is(":hidden"),a=t.METHODS.BuildDom(i,t.DOM.$contentTemplate);if(r&&!t.USE.check[o]){t.USE.check[o]=!0;var u=t.USE.menuData[o].files;return u?void a({filesList:u},function(t){t.masonry({itemSelector:".item",columnWidth:".head",percentPosition:!0,isAnimated:!0}),t.imagesLoaded(function(){t.prev().trigger("upstate"),t.masonry("layout"),t.trigger("buildCopy")}).progress(function(){t.masonry("layout")})}):console.log("文件列表不存在！")}}),t.DOM.$wrapper.on("buildCopy","li .content",function(){console.log("build copy......");var e=$(this),i=e.find(".item");i.each(function(n,e){var i=$(e),o={path:t.USE.ZeroClipboardPath,copy:function(){return $(this).prev().val()}};i.find(".url button").zclip(o),i.find(".murl button").zclip(o)})}),function(){var n=t.METHODS.BuildDom(t.DOM.$wrapper,t.DOM.$menuTemplate);$.getJSON(t.USE.mainurl).done(function(e){t.USE.menuData=e,n({menuList:e},function(t){t.on("click","li .menu",function(){var n=$(this),e=n.data("index"),i=n.next();n.find("i").text("Loading......"),n.on("upstate",function(){n.find("i").text("Loading ok").hide("slow"),n.off("upstate")}),i.trigger("loadContent",{index:e}),i.fadeToggle("slow")})})}).fail(function(){console.log("数据有错！")})}()});
